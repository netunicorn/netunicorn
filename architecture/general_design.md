# General design
This document contains a general design of the system. Also take a look at the [vocabulary](vocabulary.md).

The [user story](userstory.md) describes user's view on the system. From the user story [requirements](requirements.md) and this architecture are created.

## Workflow
1. User defines a DAG of tasks
    - Each task consists of installation part and execution part
2. The DAG defines an environment where it should be executed. 
	- The system creates an environment definition (instructions how to create the environment) using combined installation instructions from each task and pushes it to corresponding nodes
3. User asks to start the experiment. The system transfer this command to corresponding nodes. Each node spins up environment and executors.
4. Each executor starts executing the DAG
5. After executor finishes all the tasks (or fails), it reports results to the system
6. After results received, the system finalizes the corresponding environment

## Coarse architecture of the system
```mermaid
flowchart LR
	subgraph User
		fr[System Frontend]
	end
	
	subgraph Director
		direction TB
		eng[System Engine]
		ds[Deployment System]
	end
	
	
	subgraph Node1
		subgraph env1[Environment]
			ex1[Executor]
		end
	end
	
	fr --- eng
	eng --- ds
	eng ---- ex1
	ds -..- env1
```

The system consists of 3 different parts:
- User-side Frontend
- System Engine
- Executor

### User-side Frontend
Frontend is a separate module thatâ€™s located on a user side. It's a single point of interaction with the system for user.
Frontend:
- contains building blocks for tasks/DAGs
- connects to System Engine to provide information about available infrastructure
- allows user to interact with system (prepare, start, and cancel experiments, receive status, etc.)
- allows user to attach additional infrastructures to the system
See [Frontend README](frontend/README.md) for further information.

### System Engine
The engine is deployed on *system installation location (director).* Usually it would be servers of infrastructure owner (e.g., university, research lab, company) that's relatively close to infrastructure used for experiments (to reduce latency, ensure proper bandwidth, etc.).

The local infrastructure would be controlled by *deployment system*, controlled by administrators. It would be accessible by system engine via a connector.

System Engine is always available by Executors via network.

Engine:
- interacts with *deployment system* to obtain information about local infrastructure and issue commands (to deploy experiments)
- prepares environment for user's experiments
- maintains currently running experiments
- provides event system for the experiments
- controls preprocessors for experiments

See [README](director/README.md) for additional information.

### Executor
Executor works on a node inside some *environment* (usually generated by the engine). It receives a DAG and executes it, reports results, sends and receives events. Executor's lifetime is bounded by the Environment.

See [README](executor/README.md) for additional information.
